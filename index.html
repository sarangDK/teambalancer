<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LoL íŒ€ ë°¸ëŸ°ì„œ</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(135deg, #0f0f0f, #1a1a1a);
      color: #fff;
    }
    h1, h2, h3 {
      text-align: center;
      color: #00bfff;
    }
    input, select, button {
      margin: 5px;
      padding: 10px;
      border-radius: 8px;
      border: none;
      font-size: 14px;
    }
    input, select {
      width: 140px;
    }
    button {
      background-color: #222;
      color: #0ff;
      cursor: pointer;
      box-shadow: 0 0 10px #0ff;
      transition: 0.3s;
    }
    button:hover {
      background-color: #0ff;
      color: #000;
    }
    #playerList, #teamA, #teamB, #filteredResult {
      list-style: none;
      padding-left: 0;
    }
    .team {
      background-color: #121212;
      border-radius: 12px;
      margin-top: 20px;
      padding: 15px;
      box-shadow: 0 0 10px rgba(0,255,255,0.3);
    }
    .team h2 {
      color: #ff4444;
    }
    .blue h2 {
      color: #44aaff;
    }
    .player-list li, .team li {
      margin: 4px 0;
    }
    .delete-btn {
      margin-left: 10px;
      background: #ff4444;
      border-radius: 4px;
      color: white;
      padding: 2px 6px;
      font-size: 12px;
      cursor: pointer;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .filter-box {
      margin-top: 40px;
      text-align: center;
    }
    .team ul li {
  animation: fadeInUp 0.5s ease both;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
button:active {
  transform: scale(0.95);
  box-shadow: 0 0 5px #0ff;
}.view-players-btn {
    display: inline-block;
    text-align: center;
    background-color: #00bfff;
    color: #fff;
    padding: 10px 20px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    box-shadow: 0 0 10px rgba(0, 191, 255, 0.5);
    transition: all 0.3s ease;
  }

  .view-players-btn:hover {
    background-color: #fff;
    color: #00bfff;
    box-shadow: 0 0 15px rgba(0, 191, 255, 0.8);
    transform: scale(1.05);
  }
  .intro-message {
  max-width: 600px;
  margin: 0 auto 30px;
  padding: 15px 20px;
  background-color: #1e1e1e;
  border: 1px solid #00bfff;
  border-radius: 10px;
  box-shadow: 0 0 10px rgba(0, 191, 255, 0.3);
  color: #fff;
  text-align: center;
  line-height: 1.6;
  font-size: 15px;
}
.view-players-link {
  color: #0ff;
  font-weight: bold;
  text-decoration: underline;
}
.view-players-link:hover {
  color: #fff;
  text-shadow: 0 0 5px #0ff;
}









  </style>
</head>
<body>
  <h1>ğŸ® LoL íŒ€ ë°¸ëŸ°ì„œ</h1>

  <div class="intro-message">
    <p>
      ğŸ‘‹ <strong>1.í”Œë ˆì´ì–´ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•œ ë’¤</strong> <span style="color:#0ff;">â€˜ë°ì´í„° ì €ì¥â€™</span>ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br />
      <strong>2. ì´í›„ 'ë°ì´í„° ì €ì¥'ì€ ìƒˆë¡œìš´ í”Œë ˆì´ì–´ë§Œ ì¶”ê°€í•˜ê³  ëˆŒëŸ¬ì£¼ì„¸ìš”ìš”</strong>
      ê° ë§¤ì¹˜ í›„ì—ëŠ” <strong>â€˜ë¸”ë£¨íŒ€ ìŠ¹ë¦¬â€™</strong> ë˜ëŠ” <strong>â€˜ë ˆë“œíŒ€ ìŠ¹ë¦¬â€™</strong> ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼<br />
      ìŠ¹/íŒ¨ ê¸°ë¡ì´ ì €ì¥ë©ë‹ˆë‹¤.<br />
      <a href="firebaseviwer.html" class="view-players-link">ğŸ“Š ì €ì¥ëœ í”Œë ˆì´ì–´ ë³´ê¸°</a>ì—ì„œ ë¼ì¸ë³„ ìŠ¹ë¥ ì„ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”!
    </p>
  </div>

  <div class="controls">
    <input type="text" id="name" placeholder="ë‹‰ë„¤ì„" />
    <select id="tier">
      <option value="ë§ˆê·¸ì±Œ1800+">ë§ˆê·¸ì±Œ 1800+</option>
      <option value="ë§ˆê·¸ì±Œ1700-1799">ë§ˆê·¸ì±Œ 1700~1799</option>
      <option value="ë§ˆê·¸ì±Œ1600-1699">ë§ˆê·¸ì±Œ 1600~1699</option>
      <option value="ë§ˆê·¸ì±Œ1500-1599">ë§ˆê·¸ì±Œ 1500~1599</option>
      <option value="ë§ˆê·¸ì±Œ1400-1499">ë§ˆê·¸ì±Œ 1400~1499</option>
      <option value="ë§ˆê·¸ì±Œ1300-1399">ë§ˆê·¸ì±Œ 1300~1399</option>
      <option value="ë§ˆê·¸ì±Œ1200-1299">ë§ˆê·¸ì±Œ 1200~1299</option>
      <option value="ë§ˆê·¸ì±Œ1100-1199">ë§ˆê·¸ì±Œ 1100~1199</option>
      <option value="ë§ˆê·¸ì±Œ1000-1099">ë§ˆê·¸ì±Œ 1000~1099</option>
      <option value="ë§ˆê·¸ì±Œ900-999">ë§ˆê·¸ì±Œ 900~999</option>
      <option value="ë§ˆê·¸ì±Œ800-899">ë§ˆê·¸ì±Œ 800~899</option>
      <option value="ë§ˆê·¸ì±Œ700-799">ë§ˆê·¸ì±Œ 700~799</option>
      <option value="ë§ˆê·¸ì±Œ600-699">ë§ˆê·¸ì±Œ 600~699</option>
      <option value="ë§ˆê·¸ì±Œ500-599">ë§ˆê·¸ì±Œ 500~599</option>
      <option value="ë§ˆê·¸ì±Œ400-499">ë§ˆê·¸ì±Œ 400~499</option>
      <option value="ë§ˆê·¸ì±Œ300-399">ë§ˆê·¸ì±Œ 300~399</option>
      <option value="ë§ˆê·¸ì±Œ200-299">ë§ˆê·¸ì±Œ 200~299</option>
      <option value="ë§ˆê·¸ì±Œ100-199">ë§ˆê·¸ì±Œ 100~199</option>
      <option value="ë§ˆê·¸ì±Œ0-99">ë§ˆê·¸ì±Œ 0~99</option>
      <option value="ë‹¤ì´ì•„1">ë‹¤ì´ì•„ 1</option>
      <option value="ë‹¤ì´ì•„2">ë‹¤ì´ì•„ 2</option>
      <option value="ë‹¤ì´ì•„3">ë‹¤ì´ì•„ 3</option>
      <option value="ë‹¤ì´ì•„4">ë‹¤ì´ì•„ 4</option>
      <option value="ì—ë©”ë„ë“œ1">ì—ë©”ë„ë“œ 1</option>
      <option value="ì—ë©”ë„ë“œ2">ì—ë©”ë„ë“œ 2</option>
      <option value="ì—ë©”ë„ë“œ3">ì—ë©”ë„ë“œ 3</option>
      <option value="ì—ë©”ë„ë“œ4">ì—ë©”ë„ë“œ 4</option>
      <option value="í”Œë˜í‹°ë„˜1">í”Œë˜í‹°ë„˜ 1</option>
      <option value="í”Œë˜í‹°ë„˜2">í”Œë˜í‹°ë„˜ 2</option>
      <option value="í”Œë˜í‹°ë„˜3">í”Œë˜í‹°ë„˜ 3</option>
      <option value="í”Œë˜í‹°ë„˜4">í”Œë˜í‹°ë„˜ 4</option>
      <option value="ê³¨ë“œ1">ê³¨ë“œ 1</option>
      <option value="ê³¨ë“œ2">ê³¨ë“œ 2</option>
      <option value="ê³¨ë“œ3">ê³¨ë“œ 3</option>
      <option value="ê³¨ë“œ4">ê³¨ë“œ 4</option>
      <option value="ì‹¤ë²„1">ì‹¤ë²„ 1</option>
      <option value="ì‹¤ë²„2">ì‹¤ë²„ 2</option>
      <option value="ì‹¤ë²„3ì´í•˜">ì‹¤ë²„ 3 ì´í•˜</option>
    </select>
    
    </select>
    <select id="lane1">
      <option value="ìƒê´€ì—†ìŒ">ìƒê´€ì—†ìŒ</option>
      <option value="íƒ‘">íƒ‘</option>
      <option value="ì •ê¸€">ì •ê¸€</option>
      <option value="ë¯¸ë“œ">ë¯¸ë“œ</option>
      <option value="ì›ë”œ">ì›ë”œ</option>
      <option value="ì„œí¿">ì„œí¿</option>
    </select>
    <select id="lane2">
      <option value="ìƒê´€ì—†ìŒ">ìƒê´€ì—†ìŒ</option>
      <option value="íƒ‘">íƒ‘</option>
      <option value="ì •ê¸€">ì •ê¸€</option>
      <option value="ë¯¸ë“œ">ë¯¸ë“œ</option>
      <option value="ì›ë”œ">ì›ë”œ</option>
      <option value="ì„œí¿">ì„œí¿</option>
    </select>
    <button onclick="addPlayer()">ì¶”ê°€</button>
    <button onclick="clearPlayers()">ì´ˆê¸°í™”</button>
    <button onclick="savePlayersToFirebase()">ë°ì´í„° ì €ì¥</button>
    <button onclick="loadPlayersFromFirebase()">ğŸ”„ ì €ì¥ëœ íŒ€ì› ë¶ˆëŸ¬ì˜¤ê¸°</button>
   
  </div>

  <div class="controls">
      
    <a href="firebaseviwer.html" class="view-players-btn">ğŸ“Š ì €ì¥ëœ í”Œë ˆì´ì–´ ë³´ê¸°</a>
    
  </div>

  <ul id="playerList" class="player-list"></ul>
  <button onclick="generateTeams()">íŒ€ ìë™ ìƒì„±</button>

  <div class="team blue">
    <h2>ğŸ”µ ë¸”ë£¨ íŒ€</h2>
    <ul id="teamA" style="border: 1px solid #44aaff; padding: 10px; border-radius: 8px;"></ul>
    <p id="scoreA"></p>
  </div>
  
  <div class="team">
    <h2>ğŸ”´ ë ˆë“œ íŒ€</h2>
    <ul id="teamB" style="border: 1px solid #ff4444; padding: 10px; border-radius: 8px;"></ul>
    <p id="scoreB"></p>
  </div>
  
  <div style="text-align:center; margin-top: 10px;">
    <button onclick="generateTeams()">ğŸ” íŒ€ ë‹¤ì‹œ ì„ê¸°</button>
  </div>
  
  <div style="text-align:center; margin-top: 20px;">
    <button onclick="declareWinner('A')">ğŸ”µ ë¸”ë£¨ íŒ€ ìŠ¹ë¦¬</button>
    <button onclick="declareWinner('B')">ğŸ”´ ë ˆë“œ íŒ€ ìŠ¹ë¦¬</button>
  </div>


  </div>
  

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDp3Vr0l_WbvENgSuPAiN_zfzDTwYzYFzU",
      authDomain: "teambalancer-7720c.firebaseapp.com",
      projectId: "teambalancer-7720c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  
    const emoji = { íƒ‘: "ğŸ”", ì •ê¸€: "ğŸŒ²", ë¯¸ë“œ: "ğŸ§ ", ì›ë”œ: "ğŸ¯", ì„œí¿: "ğŸ›¡ï¸", ìƒê´€ì—†ìŒ: "ğŸ²", ë¯¸ì •: "ğŸ²" };
  
    const scoreTable = {
  "ë§ˆê·¸ì±Œ1800+": { íƒ‘: 58.5, ì •ê¸€: 68.4, ë¯¸ë“œ: 60.9, ì›ë”œ: 62.7, ì„œí¿: 58.2 },
  "ë§ˆê·¸ì±Œ1700-1799": { íƒ‘: 58.2, ì •ê¸€: 67.9, ë¯¸ë“œ: 60.7, ì›ë”œ: 62.5, ì„œí¿: 58 },
  "ë§ˆê·¸ì±Œ1600-1699": { íƒ‘: 57.9, ì •ê¸€: 67.3, ë¯¸ë“œ: 60.4, ì›ë”œ: 62.4, ì„œí¿: 57.8 },
  "ë§ˆê·¸ì±Œ1500-1599": { íƒ‘: 57.5, ì •ê¸€: 66.7, ë¯¸ë“œ: 60.1, ì›ë”œ: 62.2, ì„œí¿: 57.4 },
  "ë§ˆê·¸ì±Œ1400-1499": { íƒ‘: 57, ì •ê¸€: 66, ë¯¸ë“œ: 59.7, ì›ë”œ: 61.9, ì„œí¿: 56.8 },
  "ë§ˆê·¸ì±Œ1300-1399": { íƒ‘: 56.5, ì •ê¸€: 65, ë¯¸ë“œ: 59.1, ì›ë”œ: 61.4, ì„œí¿: 56.1 },
  "ë§ˆê·¸ì±Œ1200-1299": { íƒ‘: 55.9, ì •ê¸€: 63.7, ë¯¸ë“œ: 58.6, ì›ë”œ: 60.7, ì„œí¿: 55.3 },
  "ë§ˆê·¸ì±Œ1100-1199": { íƒ‘: 55.3, ì •ê¸€: 62.1, ë¯¸ë“œ: 57.4, ì›ë”œ: 60, ì„œí¿: 54.5 },
  "ë§ˆê·¸ì±Œ1000-1099": { íƒ‘: 54.7, ì •ê¸€: 60.3, ë¯¸ë“œ: 56.5, ì›ë”œ: 59.3, ì„œí¿: 53.6 },
  "ë§ˆê·¸ì±Œ900-999": { íƒ‘: 53.9, ì •ê¸€: 57.9, ë¯¸ë“œ: 55.4, ì›ë”œ: 58.4, ì„œí¿: 52.5 },
  "ë§ˆê·¸ì±Œ800-899": { íƒ‘: 52.9, ì •ê¸€: 55.4, ë¯¸ë“œ: 52.7, ì›ë”œ: 57.4, ì„œí¿: 49.5 },
  "ë§ˆê·¸ì±Œ700-799": { íƒ‘: 49.4, ì •ê¸€: 52.8, ë¯¸ë“œ: 50.8, ì›ë”œ: 52.2, ì„œí¿: 47.4 },
  "ë§ˆê·¸ì±Œ600-699": { íƒ‘: 47.2, ì •ê¸€: 50.5, ë¯¸ë“œ: 49, ì›ë”œ: 48.5, ì„œí¿: 45.3 },
  "ë§ˆê·¸ì±Œ500-599": { íƒ‘: 45.6, ì •ê¸€: 48.3, ë¯¸ë“œ: 47.7, ì›ë”œ: 45.1, ì„œí¿: 43.2 },
  "ë§ˆê·¸ì±Œ400-499": { íƒ‘: 44.1, ì •ê¸€: 46.2, ë¯¸ë“œ: 46.4, ì›ë”œ: 42.1, ì„œí¿: 41.2 },
  "ë§ˆê·¸ì±Œ300-399": { íƒ‘: 42.6, ì •ê¸€: 44.1, ë¯¸ë“œ: 45.1, ì›ë”œ: 39.5, ì„œí¿: 39.4 },
  "ë§ˆê·¸ì±Œ200-299": { íƒ‘: 39.7, ì •ê¸€: 42.2, ë¯¸ë“œ: 43.3, ì›ë”œ: 37.5, ì„œí¿: 38.1 },
  "ë§ˆê·¸ì±Œ100-199": { íƒ‘: 38.2, ì •ê¸€: 40.9, ë¯¸ë“œ: 42.6, ì›ë”œ: 35.8, ì„œí¿: 37.1 },
  "ë§ˆê·¸ì±Œ0-99": { íƒ‘: 37.2, ì •ê¸€: 38.6, ë¯¸ë“œ: 40.8, ì›ë”œ: 34, ì„œí¿: 36.1 },
  "ë‹¤ì´ì•„1": { íƒ‘: 36.2, ì •ê¸€: 38.1, ë¯¸ë“œ: 39.5, ì›ë”œ: 31.2, ì„œí¿: 35.1 },
  "ë‹¤ì´ì•„2": { íƒ‘: 34.1, ì •ê¸€: 38.7, ë¯¸ë“œ: 38.5, ì›ë”œ: 28.9, ì„œí¿: 32.9 },
  "ë‹¤ì´ì•„3": { íƒ‘: 32.1, ì •ê¸€: 38.7, ë¯¸ë“œ: 35.8, ì›ë”œ: 28.2, ì„œí¿: 31.4 },
  "ë‹¤ì´ì•„4": { íƒ‘: 30.4, ì •ê¸€: 31.8, ë¯¸ë“œ: 33.7, ì›ë”œ: 26.9, ì„œí¿: 31.7 },
  "ì—ë©”ë„ë“œ1": { íƒ‘: 29, ì •ê¸€: 29.8, ë¯¸ë“œ: 31.8, ì›ë”œ: 25.1, ì„œí¿: 30.4 },
  "ì—ë©”ë„ë“œ2": { íƒ‘: 27.2, ì •ê¸€: 27.5, ë¯¸ë“œ: 29.4, ì›ë”œ: 23.7, ì„œí¿: 29 },
  "ì—ë©”ë„ë“œ3": { íƒ‘: 25.8, ì •ê¸€: 25.6, ë¯¸ë“œ: 27.4, ì›ë”œ: 22.3, ì„œí¿: 27.9 },
  "ì—ë©”ë„ë“œ4": { íƒ‘: 24.7, ì •ê¸€: 24.1, ë¯¸ë“œ: 25.4, ì›ë”œ: 21.1, ì„œí¿: 26.8 },
  "í”Œë˜í‹°ë„˜1": { íƒ‘: 23.1, ì •ê¸€: 22.5, ë¯¸ë“œ: 23.4, ì›ë”œ: 19.9, ì„œí¿: 25.8 },
  "í”Œë˜í‹°ë„˜2": { íƒ‘: 22.1, ì •ê¸€: 21.1, ë¯¸ë“œ: 20.8, ì›ë”œ: 18.3, ì„œí¿: 24.1 },
  "í”Œë˜í‹°ë„˜3": { íƒ‘: 21.3, ì •ê¸€: 19.8, ë¯¸ë“œ: 19.3, ì›ë”œ: 17.2, ì„œí¿: 23.2 },
  "í”Œë˜í‹°ë„˜4": { íƒ‘: 20.5, ì •ê¸€: 18.5, ë¯¸ë“œ: 17.8, ì›ë”œ: 16.1, ì„œí¿: 22.3 },
  "ê³¨ë“œ1": { íƒ‘: 19.6, ì •ê¸€: 17.1, ë¯¸ë“œ: 16.3, ì›ë”œ: 14.9, ì„œí¿: 21.4 },
  "ê³¨ë“œ2": { íƒ‘: 18, ì •ê¸€: 15, ë¯¸ë“œ: 14.5, ì›ë”œ: 13.3, ì„œí¿: 19.8 },
  "ê³¨ë“œ3": { íƒ‘: 17.2, ì •ê¸€: 14, ë¯¸ë“œ: 13.6, ì›ë”œ: 12.5, ì„œí¿: 18.9 },
  "ê³¨ë“œ4": { íƒ‘: 16.4, ì •ê¸€: 13, ë¯¸ë“œ: 12.7, ì›ë”œ: 11.8, ì„œí¿: 17.8 },
  "ì‹¤ë²„1": { íƒ‘: 15.6, ì •ê¸€: 12, ë¯¸ë“œ: 11.8, ì›ë”œ: 11.2, ì„œí¿: 16 },
  "ì‹¤ë²„2": { íƒ‘: 14.8, ì •ê¸€: 11, ë¯¸ë“œ: 10.9, ì›ë”œ: 10.6, ì„œí¿: 16 },
  "ì‹¤ë²„3ì´í•˜": { íƒ‘: 14, ì •ê¸€: 10, ë¯¸ë“œ: 10, ì›ë”œ: 10, ì„œí¿: 15 }
};

  
    const players = JSON.parse(localStorage.getItem('players') || '[]');
    renderPlayerList();
  
    function addPlayer() {
  const name = document.getElementById('name').value.trim();
  const tier = document.getElementById('tier').value;
  const lane1 = document.getElementById('lane1').value;
  const lane2 = document.getElementById('lane2').value;

  const role = lane1 !== "ìƒê´€ì—†ìŒ" ? lane1 : "ë¯¸ì •";
  let score = 0;

  if (scoreTable[tier]) {
    if (role !== "ë¯¸ì •") {
      // ë©”ì¸ í¬ì§€ì…˜ ì ìˆ˜
      score = scoreTable[tier][role];
    } else if (lane2 !== "ìƒê´€ì—†ìŒ") {
      // ì„œë¸Œ í¬ì§€ì…˜ ì ìˆ˜ë¡œ ê³„ì‚°
      score = scoreTable[tier][lane2];
    } else {
      // í‰ê·  ì ìˆ˜ ê³„ì‚°
      const values = Object.values(scoreTable[tier]);
      score = Math.round(values.reduce((a, b) => a + b, 0) / values.length);
    }
  }

  players.push({ name, tier, score, role, sub: lane2, win: 0, lose: 0 });
  saveToLocal();
  renderPlayerList();
}

    function renderPlayerList() {
      const list = document.getElementById('playerList');
      list.innerHTML = '';
      players.forEach((p, i) => {
        const item = document.createElement('li');
        const winRate = (p.win + p.lose > 0) ? ` | ìŠ¹ë¥ : ${Math.round((p.win / (p.win + p.lose)) * 100)}%` : '';
        item.textContent = `${emoji[p.role] || ''} ${p.name} (${p.tier}, ${p.role}${p.sub ? ' / ' + p.sub : ''}) - ${p.score}ì  | ìŠ¹: ${p.win} íŒ¨: ${p.lose}${winRate}`;
        const edit = document.createElement('span');
        edit.textContent = 'âœï¸';
        edit.className = 'delete-btn';
        edit.onclick = () => editPlayer(i);
        const del = document.createElement('span');
        del.textContent = 'âŒ';
        del.className = 'delete-btn';
        del.onclick = () => { players.splice(i, 1); saveToLocal(); renderPlayerList(); };
        item.appendChild(edit);
        item.appendChild(del);
        list.appendChild(item);
      });
    }
  
    function editPlayer(index) {
      const p = players[index];
      document.getElementById('name').value = p.name;
      document.getElementById('tier').value = p.tier;
      document.getElementById('lane1').value = p.role;
      document.getElementById('lane2').value = p.sub;
      players.splice(index, 1);
      saveToLocal();
      renderPlayerList();
    }
  
    function clearPlayers() {
      players.length = 0;
      saveToLocal();
      renderPlayerList();
      document.getElementById('teamA').innerHTML = '';
      document.getElementById('teamB').innerHTML = '';
      document.getElementById('scoreA').textContent = '';
      document.getElementById('scoreB').textContent = '';
    }
  
    let currentTeams = { A: [], B: [] };
  
   
  function generateTeams() {
    const shuffled = [...players].sort(() => Math.random() - 0.5).sort((a, b) => b.score - a.score);
    const teamA = [], teamB = [];
    let sumA = 0, sumB = 0;

    function canAdd(player, team) {
      const lanes = team.map(p => p.role);
      if (lanes.includes(player.role)) {
        if (player.sub && !lanes.includes(player.sub)) return true;
        return false;
      }
      return true;
    }

    for (const player of shuffled) {
      if (teamA.length < 5 && (sumA <= sumB || teamB.length >= 5) && canAdd(player, teamA)) {
        teamA.push(player);
        sumA += player.score;
      } else if (teamB.length < 5 && canAdd(player, teamB)) {
        teamB.push(player);
        sumB += player.score;
      } else if (teamA.length < 5) {
        teamA.push(player);
        sumA += player.score;
      } else if (teamB.length < 5) {
        teamB.push(player);
        sumB += player.score;
      }
      if (teamA.length === 5 && teamB.length === 5) break;
    }

    currentTeams = { A: teamA, B: teamB };
    renderTeams(teamA, teamB, sumA, sumB);
  }



  const leftovers = players.filter(p => !usedNames.has(p.name));
  leftovers.sort(() => Math.random() - 0.5);
  let scoreA = teamA.reduce((s, p) => s + p.score, 0);
  let scoreB = teamB.reduce((s, p) => s + p.score, 0);

  leftovers.forEach(p => {
    if (scoreA <= scoreB) {
      teamA.push(p); scoreA += p.score;
    } else {
      teamB.push(p); scoreB += p.score;
    }
  });

  currentTeams = { A: teamA, B: teamB };
  renderTeams(teamA, teamB, scoreA, scoreB);


  
    function renderTeams(teamA, teamB, scoreA, scoreB) {
      const listA = document.getElementById('teamA');
      const listB = document.getElementById('teamB');
      listA.innerHTML = '';
      listB.innerHTML = '';
      teamA.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${emoji[p.role] || ''} ${p.name} (${p.role}${p.sub ? ' / ' + p.sub : ''}) - ${p.score}ì `;
        listA.appendChild(li);
      });
      teamB.forEach(p => {
        const li = document.createElement('li');
        li.textContent = `${emoji[p.role] || ''} ${p.name} (${p.role}${p.sub ? ' / ' + p.sub : ''}) - ${p.score}ì `;
        listB.appendChild(li);
      });
      document.getElementById('scoreA').textContent = `ì´ì : ${scoreA}`;
      document.getElementById('scoreB').textContent = `ì´ì : ${scoreB}`;
    }
  
    function savePlayersToFirebase() {
  const promises = players.map(p =>
    db.collection('players')
      .where('name', '==', p.name)
      .get()
      .then(snapshot => {
        if (snapshot.empty) {
          // ì¡´ì¬í•˜ì§€ ì•Šì„ ë•Œë§Œ ì¶”ê°€
          return db.collection('players').add(p);
        } else {
          console.log(`âš ï¸ ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í”Œë ˆì´ì–´: ${p.name}`);
          return Promise.resolve(); // ì•„ë¬´ê²ƒë„ ì•ˆ í•¨
        }
      })
  );

  Promise.all(promises)
    .then(() => {
      Swal.fire({
        icon: 'success',
        title: 'ì €ì¥ ì™„ë£Œ!',
        text: 'ì¤‘ë³µì„ ì œì™¸í•œ ìƒˆë¡œìš´ í”Œë ˆì´ì–´ê°€ Firebaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.',
        confirmButtonColor: '#00bfff',
        background: '#1a1a1a',
        color: '#fff'
      });
    })
    .catch(error => {
      Swal.fire({
        icon: 'error',
        title: 'ì €ì¥ ì‹¤íŒ¨',
        text: `ì—ëŸ¬: ${error.message}`,
        confirmButtonColor: '#ff4444',
        background: '#1a1a1a',
        color: '#fff'
      });
    });
}

  
    function saveToLocal() {
      localStorage.setItem('players', JSON.stringify(players));
    }
    function updatePlayerInFirebase(playerName, winIncrement = 0, loseIncrement = 0) {
      db.collection('players')
        .where('name', '==', playerName)
        .get()
        .then(querySnapshot => {
          if (!querySnapshot.empty) {
            querySnapshot.forEach(doc => {
              const playerData = doc.data();
              const updatedWin = (playerData.win || 0) + winIncrement;
              const updatedLose = (playerData.lose || 0) + loseIncrement;
              db.collection('players').doc(doc.id).update({ win: updatedWin, lose: updatedLose });
            });
          }
        });
    }

    function declareWinner(team) {
      const winTeam = currentTeams[team];
      const loseTeam = currentTeams[team === 'A' ? 'B' : 'A'];
      winTeam.forEach(p => {
        const found = players.find(pl => pl.name === p.name);
        if (found) found.win = (found.win || 0) + 1;
        updatePlayerInFirebase(p.name, 1, 0);
      });
      loseTeam.forEach(p => {
        const found = players.find(pl => pl.name === p.name);
        if (found) found.lose = (found.lose || 0) + 1;
        updatePlayerInFirebase(p.name, 0, 1);
      });
      saveToLocal();
      renderPlayerList();
    }

    function loadPlayersFromFirebase() {
  db.collection('players')
    .get()
    .then(snapshot => {
      const loadedPlayers = [];
      snapshot.forEach(doc => {
        loadedPlayers.push(doc.data());
      });

      // localStorageì— ì €ì¥
      localStorage.setItem('players', JSON.stringify(loadedPlayers));
      players.length = 0;
      players.push(...loadedPlayers);
      renderPlayerList();

      Swal.fire({
        icon: 'info',
        title: 'ë°ì´í„° ë¡œë“œ ì™„ë£Œ!',
        text: `${loadedPlayers.length}ëª…ì˜ í”Œë ˆì´ì–´ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.`,
        confirmButtonColor: '#00bfff',
        background: '#1a1a1a',
        color: '#fff'
      });
    })
    .catch(error => {
      console.error("âŒ Firebaseì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", error);
      Swal.fire({
        icon: 'error',
        title: 'ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨',
        text: `ì—ëŸ¬: ${error.message}`,
        confirmButtonColor: '#ff4444',
        background: '#1a1a1a',
        color: '#fff'
      });
    });
}



  </script>
</body>
</html>
